# BR-Bot

Чат-бот на основе LangChain с использованием векторной базы данных PostgreSQL для хранения и поиска информации.

## Описание проекта

BR-Bot - это интеллектуальный чат-бот, построенный с использованием современных технологий обработки естественного языка. Бот использует LangChain для обработки сообщений и pgvector для эффективного хранения и поиска векторных представлений данных.

## Основные функции

- Интерактивный чат-интерфейс
- Векторное хранилище на основе PostgreSQL
- Обработка естественного языка с помощью LangChain
- Масштабируемая архитектура с использованием Docker

## Технологический стек

- Python 3.11+
- FastAPI
- LangChain
- PostgreSQL с расширением pgvector
- Docker и Docker Compose
- Sentence Transformers

## Структура проекта

```
br-bot/
├── agents/          # Агенты LangChain и графы взаимодействия
├── api/             # FastAPI эндпоинты
├── config/          # Конфигурационные файлы
├── documents/       # Директория для документов
├── domain/          # Доменная логика
├── scripts/         # Вспомогательные скрипты
├── services/        # Сервисные слои
├── main.py         # Точка входа приложения
└── docker-compose.yml
```

## Установка и запуск

### Предварительные требования

- Python 3.11 или выше
- Docker и Docker Compose
- PostgreSQL

### Настройка окружения

1. Клонируйте репозиторий:

```bash
git clone <repository-url>
cd br-bot
```

2. Создайте и активируйте виртуальное окружение:

```bash
python -m venv .venv
source .venv/bin/activate  # для Linux/macOS
# или
.venv\Scripts\activate  # для Windows
```

3. Установите зависимости:

```bash
pip install -e .
```

4. Создайте файл .env на основе .env.example и заполните необходимые переменные окружения:

```bash
cp .env.example .env
```

### Запуск базы данных

Запустите PostgreSQL с расширением pgvector через Docker:

```bash
docker-compose up -d
```

### Запуск приложения

Приложение можно запустить в двух режимах:

1. **API Сервер**

Запустите API сервер:
```bash
python main.py
```

API будет доступен по адресу `http://localhost:8000` (или в соответствии с настройками в `.env`)

2. **CLI Утилита**

Запустите консольный чат:
```bash
python scripts/chat.py
```

### API Документация

После запуска сервера вы можете просмотреть документацию API в двух форматах:

1. **Swagger UI** (интерактивная документация):
   - Откройте `http://localhost:8000/docs` в браузере
   - Тестируйте API endpoints прямо из браузера
   - Просматривайте схемы запросов и ответов
   - Экспериментируйте с различными параметрами

2. **ReDoc** (альтернативный вид документации):
   - Откройте `http://localhost:8000/redoc` в браузере
   - Более удобный формат для сложных схем
   - Лучше подходит для понимания структуры API

#### Доступные Endpoints

##### Chat API
- `POST /chat` - Отправить сообщение боту
- `GET /chat/{thread_id}/history` - Получить историю чата
- `DELETE /chat/{thread_id}` - Удалить историю чата

##### Document API
- `POST /upload/ba-document` - Загрузить и обработать BA документ
- `POST /upload/sa-document` - Загрузить и обработать SA документ

Для подробной информации о форматах запросов/ответов и примерах обратитесь к Swagger UI или ReDoc документации.

## Использование

Вы можете взаимодействовать с ботом через:
1. **REST API** - используя документацию Swagger/ReDoc
2. **Консольный интерфейс** - запустите CLI утилиту и общайтесь с ботом в терминале (введите 'exit' для выхода)

## Разработка

### Структура кода

- `agents/`: Содержит реализации агентов LangChain и графы их взаимодействия
- `api/`: REST API эндпоинты
- `config/`: Конфигурационные файлы и настройки
- `domain/`: Бизнес-логика и доменные модели
- `services/`: Сервисные слои для работы с внешними системами
- `scripts/`: Вспомогательные скрипты для разработки и деплоя

### Добавление новых функций

1. Создайте новый агент в директории `agents/`
2. Обновите граф взаимодействия в `agents/graph.py`
3. При необходимости добавьте новые сервисы в `services/`
4. Обновите конфигурацию в `config/`

## Переменные окружения

Основные переменные окружения, которые необходимо настроить:

### Конфигурация API сервера
- `BR_BOT_HOST`: Хост для API сервера (по умолчанию: 0.0.0.0)
- `BR_BOT_PORT`: Порт для API сервера (по умолчанию: 8000)

### Конфигурация базы данных
- `DB_NAME`: Имя базы данных PostgreSQL
- `DB_USER`: Пользователь базы данных
- `DB_PASSWORD`: Пароль для доступа к базе данных
- `DB_HOST`: Хост базы данных
- `DB_PORT`: Порт для подключения к базе данных

### Конфигурация API сервисов
- `GIGACHAT_CREDENTIALS`: Учетные данные для GigaChat API
