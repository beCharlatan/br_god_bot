# br_god_bot

Это приложение предназначено для обработки документов, формирования эмбеддингов с использованием API GigaChat, а также для поиска схожих документов. Приложение написано на Python и использует модульную архитектуру для разделения логики по разным сервисам: обработка документов, эмбеддинги, работа с документами и т.д.

## Основные возможности

- Разбиение документа на чанки с использованием библиотеки `langchain_text_splitters`.
- Создание эмбеддингов для каждого чанка через API GigaChat.
- Хранение эмбеддингов для дальнейшего поиска.
- Поиск похожих документов на основе эмбеддингов.

## Структура проекта

- **/services/embeddings/**: содержит классы для обработки эмбеддингов документов:

  - `base_document_embedder.py` — базовый интерфейс и реализация создания эмбеддингов.
  - `sa_document_embedder.py` — реализация для документов типа "SA".

- **/services/documents/**: содержит классы для взаимодействия с документами, включая их хранение и поиск.

- **/scripts/**: скрипты для загрузки и обработки документов, например, `load_ba_document.py`.

- **/domain/models/**: содержит модели данных, использующиеся в проекте (например, модель эмбеддинга).

## Установка и запуск

### Требования

- Python 3.7+
- Установите зависимости, указанные в файле `requirements.txt` (если такой файл отсутствует, создайте его с необходимыми пакетами, например, `langchain_text_splitters`, `tenacity` и другие).

### Установка зависимостей

Выполните следующую команду в терминале в корневой директории проекта:

```bash
pip install -r requirements.txt
```

### Запуск приложения

Приложение можно запускать с помощью следующих команд. Например, чтобы загрузить документ и сформировать эмбеддинги, выполните:

```bash
PYTHONPATH=./ python ./scripts/load_ba_document.py <путь_к_документу> <URL_страницы>
```

Пример:

```bash
PYTHONPATH=./ python ./scripts/load_ba_document.py documents/avtopodbor.docx https://confluence.example.com/avtopodbor
```

## Документация

### Основные компоненты

1. **BaseDocumentEmbedder**

   - Отвечает за разбиение документа на части и создание эмбеддингов.
   - Метод `process_document` принимает текст документа и идентификатор, разбивает документ на чанки и создает эмбеддинги для каждого чанка с помощью сервиса эмбеддингов.

2. **SA Document Embedder**

   - Расширяет базовую функциональность для обработки документов типа "SA".

3. **Document Service**
   - Отвечает за хранение и поиск документов, включая их метаданные и сформированные эмбеддинги.

### Обработка документов

При загрузке документа скрипт:

- Читает содержимое документа.
- Разбивает текст на чанки заданного размера.
- Создает эмбеддинги для каждого чанка, используя API GigaChat (обработка выполняется последовательно).
- Сохраняет полученные эмбеддинги в базу или иную систему хранения для последующего поиска схожих документов.

### Идеи для развития

- Добавить многопоточность для параллельной обработки чанков.
- Реализовать систему повторных попыток и управление нагрузкой на API, чтобы избежать ошибок "Too Many Requests".
- Улучшить алгоритмы поиска схожих документов, используя дополнительные методы агрегации эмбеддингов.
